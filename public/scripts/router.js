// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(["jquery", "underscore", "backbone", "models/proposal", "collections/proposals", "views/proposal", "views/proposals"], function($, _, Backbone, Proposal, Proposals, ProposalView, ProposalsView) {
    "use strict";
    var Router, _ref;
    Router = (function(_super) {
      __extends(Router, _super);

      function Router() {
        _ref = Router.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      Router.prototype.routes = {
        "": "index",
        "new": "new",
        ":id": "show"
      };

      Router.prototype.index = function() {
        return app.view = new ProposalsView;
      };

      Router.prototype["new"] = function() {
        var d,
          _this = this;
        $("input[name=downvoting_enabled]").on("change", function(e) {
          if ($(e.currentTarget).val() === "true") {
            return $("#proposal_up_tweet, #proposal_down_tweet").removeAttr("disabled").parent("p").show();
          } else {
            return $("#proposal_up_tweet, #proposal_down_tweet").attr("disabled", true).parent("p").hide();
          }
        });
        $("textarea, input").on("change", function(e) {
          var $e;
          $e = $(e.currentTarget);
          if ($e.hasClass("error")) {
            return $e.removeClass("error").parent("p").find("small").remove();
          }
        });
        d = new Date();
        $("#proposal_started_at").val("" + (d.getDate()) + "/" + (d.getMonth() + 1) + "/" + (d.getFullYear() - 1));
        $("#proposal_finished_at").val("" + (d.getDate()) + "/" + (d.getMonth() + 1) + "/" + (d.getFullYear() + 1));
        return $("#new_proposal").on("submit", function(e) {
          var $e, data, proposals;
          e.preventDefault();
          $e = $(e.currentTarget);
          app.set_button_state($e.find("button")[0]);
          data = _.serializeForm(e.currentTarget);
          proposals = new Proposals;
          return proposals.create(data, {
            success: function(model) {
              return window.location.href = "/" + (model.get("id"));
            },
            error: function(model, xhr) {
              var error, errors, _results;
              app.set_button_state($e.find("button")[0], false);
              errors = JSON.parse(xhr.responseText);
              $(".error_container").remove();
              _results = [];
              for (error in errors) {
                _results.push($("#proposal_" + error).addClass("error").parent("p").append("<small class=\"error_container\"><br/>" + (errors[error].join(",")) + "</small>"));
              }
              return _results;
            }
          });
        });
      };

      Router.prototype.show = function(id) {
        return app.view = new ProposalView({
          id: id
        });
      };

      return Router;

    })(Backbone.Router);
    return Router;
  });

}).call(this);
